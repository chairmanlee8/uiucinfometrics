<html>
<head>
    <title>UIUC Infometrics</title>
    
    <script type="text/javascript" src="jquery-1.5.1.min.js"></script>
    <script type="text/javascript">
        function get_class_info()
        {
            var theClassName = $('#class_form > input[name=class]').val();
            
            $.post(
                'uiuc-catalog-ajax.py/query_class', {'className': theClassName},
                function(data)
                {
                    $("#output_div").html("<table><tr>");
                    
                    for(var section in data)
                    {
                        $("#output_div").append("<td>" + section + "</td>");
                    }
                    
                    $("#output_div").append("</tr><tr>");
                    
                    // Create histograms                    
                    for(var section in data)
                    {
                        var thisHistogram = new Object;
                        
                        for(var i in data[section])
                        {
                            var startHour = data[section][i];
                            
                            if(startHour in thisHistogram) thisHistogram[startHour] += 1;
                            else thisHistogram[startHour] = 1;
                        }
                        
                        var maxValue = 0;
                        var barCount = 0;
                        
                        for(var i in thisHistogram)
                        {
                            barCount += 1;
                            maxValue = Math.max(maxValue, thisHistogram[i]);
                        }
                        
                        // Make google charts API url and add img tag
                        var chartApiParams = new Object;
                        
                        //chartApiParams["chtt"] = section.replace(/\s+/g, "+");
                        chartApiParams["chbh"] = "a";
                        chartApiParams["cht"] = "bvs";
                        chartApiParams["chs"] = String(barCount * 25 + 50) + "x150";
                        chartApiParams["chds"] = "0," + String(maxValue);
                        chartApiParams["chxr"] = "1,0," + String(maxValue);
                        chartApiParams["chco"] = "C6D9FD";
                        chartApiParams["chd"] = "t:";
                        chartApiParams["chxt"] = "x,y";
                        chartApiParams["chxl"] = "0:";
                        
                        for(var hour in thisHistogram)
                        {
                            chartApiParams["chxl"] += "|" + hour;
                            chartApiParams["chd"] += String(thisHistogram[hour]) + ",";
                        }
                        
                        // Remove last comma from ["chd"]
                        chartApiParams["chd"] = chartApiParams["chd"].slice(0, chartApiParams["chd"].length - 1);
                        
                        var chartApiUrl = "https://chart.googleapis.com/chart?";
                        
                        for(var i in chartApiParams)
                        {
                            chartApiUrl += i + "=" + chartApiParams[i] + "&";
                        }
                        
                        $("#output_div").append("<td><img src=\"" + chartApiUrl + "\" /></td>");
                    }
                    
                    $("#output_div").append("</tr></table>");
                },
                "json"
            );
        }
    </script>
    
    <style type="text/css">
        #output_div img
        {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <form id="class_form">
        <input type="text" name="class" />
        <input type="button" value="Get Info" onclick="javascript:get_class_info();" />
    </form>
    
    <div id="output_div">
    </div>
</body>

</html>